# Адаптер курсов

Инструмент для автоматизированного анализа и разбора курсов с использованием искусственного интеллекта Grok (x-ai/grok-2-1212) через OpenRouter API и сохранением результатов в графовую базу данных Neo4j.

## Функциональные возможности

- Анализ текста курса с выделением глав и ключевых понятий
- Автоматическое определение структуры курса (с явным делением на главы или без)
- Извлечение определений, примеров и формулировка контрольных вопросов для каждого понятия
- Выявление связей между понятиями и построение графа знаний
- Поддержка нескольких независимых курсов в одной базе данных
- Гибкий экспорт результатов в JSON для дальнейшего использования

## Начало работы

### Требования
- Python 3.6 или выше
- Neo4j (установленный и запущенный)
- API-ключ OpenRouter для доступа к модели Grok AI

### Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/username/adapter_course.git
cd adapter_course
```

2. Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate     # для Windows
pip install requests py2neo python-dotenv
```

3. Настройте переменные окружения, создав файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

4. Отредактируйте файл `.env`, указав необходимые параметры:
```
# OpenRouter API ключ
OPENROUTER_API_KEY=ваш_ключ_api

# Neo4j конфигурация
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=ваш_пароль_neo4j

# Модель AI для анализа
AI_MODEL=x-ai/grok-2-1212
```

## Руководство пользователя

### Создание и управление курсами

#### Создание нового курса
```bash
python create_course.py "Название курса" "Описание курса"
```

#### Просмотр списка доступных курсов
```bash
python analyze_concepts_in_depth.py --list
```

#### Очистка структуры курса (сохраняя понятия)
```bash
python reset_course_structure.py --course "Название курса"
```

#### Полная очистка курса (включая понятия)
```bash
python reset_course_structure.py --course "Название курса" --delete-concepts
```

### Анализ курсов

#### Автоматическое определение формата курса
```bash
python course_format_detector.py путь_к_файлу_курса.txt
```

#### Полный анализ курса
```bash
python adapter.py --course "Название курса" --file путь_к_файлу.txt
```

#### Анализ понятий, у которых ещё нет определений
```bash
python analyze_concepts_in_depth.py --course "Название курса" --file путь_к_файлу.txt
```

#### Извлечение понятий из курса без их анализа
```bash
python analyze_concepts_in_depth.py --course "Название курса" --file путь_к_файлу.txt --extract-concepts
```

#### Выявление структуры глав в курсе без явного деления(курсы, в которых не указываются используемые понятия в конце главы)
```bash
python detect_chapters.py --course "Название курса" --file путь_к_файлу.txt
```

### Экспорт данных

#### Экспорт графа знаний конкретного курса
```bash
python export_graph.py --course "Название курса"
```

#### Экспорт полного графа всех курсов
```bash
python export_graph.py
```

### Просмотр статистики

#### Просмотр статистики по всем курсам
```bash
python get_stats.py
```

### Резервное копирование и восстановление

#### Создание резервной копии базы данных
```bash
python backup_neo4j.py backup
```

#### Просмотр списка доступных резервных копий
```bash
python backup_neo4j.py list
```

#### Восстановление из резервной копии
```bash
python backup_neo4j.py restore --file backups/neo4j_backup_YYYYMMDD_HHMMSS.json
```

## Структура проекта

### Основные скрипты
- `adapter.py` — основной скрипт анализа курса
- `analyze_concepts_in_depth.py` — углубленный анализ понятий
- `create_course.py` — создание нового курса
- `detect_chapters.py` — выявление структуры глав в курсе
- `course_format_detector.py` — определение формата курса
- `extract_concepts.py` — извлечение понятий из курса
- `reset_course_structure.py` — сброс структуры курса
- `export_graph.py` — экспорт графа знаний
- `get_stats.py` — получение статистики по курсам
- `backup_neo4j.py` — создание и восстановление резервных копий базы данных

### Вспомогательные файлы
- `.env` — файл с переменными окружения
- `.env.example` — пример файла с переменными окружения
- `results/` — директория для хранения результатов анализа

## Структура данных

### Типы узлов в Neo4j
- `Course` — узел курса
- `Chapter` — узел главы
- `Concept` — узел понятия

### Типы связей в Neo4j
- `PART_OF` — является частью (глава → курс, понятие → курс)
- `MENTIONED_IN` — упоминается в (понятие → глава)
- `RELATES_TO` — связано с
- `IS_A` — является
- `PREREQUISITE_FOR` — необходимо для
- `EXAMPLE_OF` — пример
- `CONTRASTS_WITH` — противоположно
- `EVOLVED_FROM` — развилось из
- `USED_IN` — используется в

## Форматы курсов

Система поддерживает два основных формата курсов:

1. **chapter-based** — курс с явным делением на главы, где понятия определены внутри глав
2. **glossary-based** — курс с перечнем понятий в конце без явного деления на главы

Формат определяется автоматически или может быть указан вручную через параметр `--course-format`.

## Примеры использования

### Полный процесс анализа курса с явными главами

```bash
# Создание нового курса
python create_course.py "Системное саморазвитие" "Курс о системном подходе к саморазвитию"

# Анализ курса
python adapter.py --course "Системное саморазвитие" --file course.txt

# Углубленный анализ понятий
python analyze_concepts_in_depth.py --course "Системное саморазвитие" --file course.txt

# Экспорт результатов
python export_graph.py --course "Системное саморазвитие"
```

### Полный процесс анализа курса без явных глав

```bash
# Создание нового курса
python create_course.py "Практики саморазвития" "Курс о практиках саморазвития"

# Выявление структуры глав
python detect_chapters.py --course "Практики саморазвития" --file course2.txt

# Углубленный анализ понятий
python analyze_concepts_in_depth.py --course "Практики саморазвития" --file course2.txt

# Экспорт результатов
python export_graph.py --course "Практики саморазвития"
```

## Устранение неполадок

### Очистка данных

Если возникли проблемы с данными в Neo4j, вы можете сбросить структуру курса:

```bash
python reset_course_structure.py --course "Название курса"
```

Для полной очистки, включая удаление понятий:

```bash
python reset_course_structure.py --course "Название курса" --delete-concepts
```

### Ограничения API

При большом объеме данных могут возникать ограничения по количеству запросов к API. В этом случае:

1. Увеличьте паузу между запросами в скриптах
2. Уменьшите размер партии для анализа понятий
3. Используйте параметр `--limit` для ограничения количества обрабатываемых понятий 